# SPI

serial peripheral interface 串行外设接口

特点:串行,全双工(两条线分别负责发送和接收),同步(有时钟线,SCK),仅支持一主多从
**一发必有一收,想收必须一发**

注:在面对多个从机的情况下,若从机的SS未被选中,则它们的MISO引脚必须关断输出,表示为或配置为高阻态
结束通信后,从机的MISO又会变回高阻态
四条通信线: 
1 . SCK (又称SCLK CLK CK)											时钟线
2 . MOSI / MISO(又称DO(data output ) 和 DI(data input))        		 数据线
3 . SS(Slave Select) 又称 NSS(Not Slave Select) CS(Chip select)		片选(从机选择线)

注:在模块上的DO和DI都是以模块为主体来说的,比如在模块上DO表示模块发,即 MISO,DI表示模块收,即MOSI

SPI的数据收发,都是基于**字节交换**来实现的
整个通信流程就是主机和从机之间的数据交换

一般在接收时,主机会统一发送0x00或0xFF,去和从机换数据

# 数据帧
起始条件:SS出现下降沿
停止条件:SS出现上升沿
SPI有两个位可以决定数据帧的时序
1. CPOL 该位决定SPI在空闲时时钟线的电平状态    值为0 表示空闲时时钟线为低电平,为1则为高电平
2. CPHA 该位决定SPI的数据读取时机             值为0 表示在第一个时钟线边沿接收数据,为1则在第二个时钟线边沿接收数据

根据这两位的不同就出现了什么时候接收数据,什么时候变换数据,也就是说控制了时钟线就控制了数据的收发形势

例:CPOL = 0 (空闲时SCK低电平) CPHA = 1(在第二个SCK边沿接收数据)
在这个情况下,数据在SDK为下降沿时接收数据,在SCK上升沿时变换数据

# SPI时序

SPI和I2C不同,I2C第一次发送的字节必须是器件地址,而SPI第一次发送的是指令码,从机有自己的指令集,什么指令对应什么功能

以W25Q64为例 0x06表示的是写指令